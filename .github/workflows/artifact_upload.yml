name: SCRAPE_SOFIFA

on:
  push:
    branches:
    - feature/multi-artifact-upload

jobs:
  my_job:
    name: Test Job
    runs-on: "ubuntu-latest"

    steps:
      - uses: actions/checkout@v2

      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%d_%H-%M-%S')"

      - name: Setup Environment
        # e.g. create work dirst, store in env variables ... https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-commands-for-github-actions
        run: |
          echo "WORK_DIR=${{ github.workspace }}" >> $GITHUB_ENV
          echo "DATA_DIR_1=${{ github.workspace }}/data1" >> $GITHUB_ENV
          echo "DATA_DIR_2=${{ github.workspace }}/data2" >> $GITHUB_ENV

      - name: Setup Dirs
        run: |
          echo "DATA_DIR_1: '${DATA_DIR_1}'"
          echo "DATA_DIR_2: '${DATA_DIR_2}'"

          echo "Command: 'mkdir -p ${DATA_DIR_1}'"
          mkdir -p ${DATA_DIR_1}
          echo "Command: 'mkdir -p ${DATA_DIR_1}'"
          mkdir -p ${DATA_DIR_1}

          echo "Command: 'ls -altR ${DATA_DIR}'"
          ls -altR ${DATA_DIR}

      - name: Create Files
        run: |
          echo "FILE 1" > "${DATA_DIR_1}/file_1.txt"
          echo "FILE 2" > "${DATA_DIR_2}/file_2.txt"

      - name: Zip Releases
        run: |
          pushd "${DATA_DIR}"
          zip -r ${WORK_DIR}/data1.zip data1
          zip -r ${WORK_DIR}/data2.zip data2
          popd

      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ steps.date.outputs.date }}
          release_name: Release ${{ steps.date.outputs.date }}
          draft: false
          prerelease: false

      - name: Upload Release Asset 1
        id: upload-release-asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./data1.zip
          asset_name: data1.zip
          asset_content_type: application/zip

      - name: Upload Release Asset 2
        id: upload-release-asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./data2.zip
          asset_name: data2.zip
          asset_content_type: application/zip
